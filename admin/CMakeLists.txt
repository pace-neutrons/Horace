# Copy template files into <build_dir>/local_init
# LOCAL_INIT_DIR is defined in the top-level CMakeLists
file(MAKE_DIRECTORY ${LOCAL_INIT_DIR})

# Configure herbert/horace_on templates into build/local_init
# This directory is added to the Matlab path when CTest is run, which enables
# parallel workers to run herbert/horace_on in tests.
configure_file("${Herbert_ON_TEMPLATE}" "${LOCAL_INIT_DIR}/herbert_on.m")
configure_file("horace_on.m.template" "${LOCAL_INIT_DIR}/horace_on.m")

# Copy Horace worker templates
if(BUILD_TESTING)
    configure_file("worker_4tests.m.template" "${LOCAL_INIT_DIR}/worker_4tests.m")
endif()
configure_file("worker_v2.m.template" "${LOCAL_INIT_DIR}/worker_v2.m")


# A warning to add to the top of CMake generated files to warn users
set(Horace_AUTO_GENERATED_FILE_WARNING
    "This file is auto-generated by CMake. Do not edit, any edits may be lost.")

# Copy horace_get_build_version template formatting it with the project version numbers
configure_file("horace_get_build_version.m.template"
    "${Horace_ROOT}/horace_core/admin/horace_get_build_version.m")

# Copy version.h template formatting it with the project version numbers
configure_file("version.h.template"
    "${Horace_ROOT}/_LowLevelCode/cpp/utility/version.h")

# =============================================================================
# Install commands
# =============================================================================
set(TEMPLATE_FILES
    "horace_on.m.template"
    "worker_v2.m.template"
    "${Herbert_ON_TEMPLATE}"

)
install(
    FILES "horace_install.m" ${TEMPLATE_FILES}
    DESTINATION "."
)
