

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7. Loading sqw and dnd objects to memory &mdash; Horace  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. Other shape functions" href="Reshaping_etc.html" />
    <link rel="prev" title="6. Special SQW information from sqw objects and files" href="Special_sqw_information.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Horace
              <img src="../_static/150px-Quintus_Horatius_Flaccus.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Introduction and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User_guide.html">User’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../Horace_manual.html">Horace Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Planning_a_Horace_scan.html">1. Planning a Horace scan</a></li>
<li class="toctree-l2"><a class="reference internal" href="Generating_SQW_files.html">2. Generating SQW files</a></li>
<li class="toctree-l2"><a class="reference internal" href="Data_diagnostics.html">3. Data diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="Correcting_for_sample_misalignment.html">4. Correcting for sample misalignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="Cutting_data_of_interest_from_SQW_files_and_objects.html">5. Cutting data of interest from SQW files and objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="Special_sqw_information.html">6. Special <code class="docutils literal notranslate"><span class="pre">SQW</span></code> information from sqw objects and files</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7. Loading <code class="docutils literal notranslate"><span class="pre">sqw</span></code> and <code class="docutils literal notranslate"><span class="pre">dnd</span></code> objects to memory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#read-horace">7.1. read_horace</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read-sqw">7.2. read_sqw</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read-dnd">7.3. read_dnd</a></li>
<li class="toctree-l3"><a class="reference internal" href="#constructing-sqw-object-from-filename">7.4. Constructing <code class="docutils literal notranslate"><span class="pre">sqw</span></code> object from filename</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#saving-sqw-objects-from-memory-and-creating-filebacked-objects">8. Saving sqw objects from memory and creating filebacked objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#save">8.1. save</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-filebacked-objects-from-data-on-disk">8.2. Create filebacked objects from data on disk</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Reshaping_etc.html">9. Other shape functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Symmetrising_etc.html">10. Symmetry Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Unary_operations.html">11. Unary operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Binary_operations.html">12. Binary operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Plotting.html">13. Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="Simulation.html">14. Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Multifit.html">15. Multifit</a></li>
<li class="toctree-l2"><a class="reference internal" href="Tobyfit.html">16. Tobyfit</a></li>
<li class="toctree-l2"><a class="reference internal" href="Parallel.html">17. Running Horace in Parallel</a></li>
<li class="toctree-l2"><a class="reference internal" href="Changing_Horace_settings.html">18. Changing Horace settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="List_of_functions.html">List of functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Input_file_formats.html">Input file formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="FAQ.html">FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Example_scripts.html">Example Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Citing.html">Citing Horace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Developers.html">For Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Contributing.html">Contributing to Horace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../General_disclaimer.html">General disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Previous_versions.html">Previous Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Horace</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../Horace_manual.html">Horace Manual</a></li>
      <li class="breadcrumb-item active"><span class="section-number">7. </span>Loading <code class="docutils literal notranslate"><span class="pre">sqw</span></code> and <code class="docutils literal notranslate"><span class="pre">dnd</span></code> objects to memory</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/manual/Save_and_load.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="loading-sqw-and-dnd-objects-to-memory">
<h1><span class="section-number">7. </span>Loading <code class="docutils literal notranslate"><span class="pre">sqw</span></code> and <code class="docutils literal notranslate"><span class="pre">dnd</span></code> objects to memory<a class="headerlink" href="#loading-sqw-and-dnd-objects-to-memory" title="Permalink to this heading"></a></h1>
<p>Majority of Horace algorithms accept the name of file containing binary <code class="docutils literal notranslate"><span class="pre">sqw</span></code> or <code class="docutils literal notranslate"><span class="pre">dnd</span></code> object
as the source of the data for operations. This is necessary as not every <code class="docutils literal notranslate"><span class="pre">sqw</span></code> object may fit to memory.
When an object can fit memory it is convenient to place it for speed and convenience operating with it.
Horace provides two methods of placing sqw objects in memory: <code class="docutils literal notranslate"><span class="pre">read</span></code> or <code class="docutils literal notranslate"><span class="pre">load</span></code> operations and
<code class="docutils literal notranslate"><span class="pre">sqw/dnd</span></code> object construction.</p>
<p><code class="docutils literal notranslate"><span class="pre">load</span></code> is standard operation, which allow loading <code class="docutils literal notranslate"><span class="pre">sqw/dnd</span></code> objects or arrays of such objects previously
saved from MATLAB to standard MATLAB <code class="docutils literal notranslate"><span class="pre">.mat</span></code> file using MATLAB <code class="docutils literal notranslate"><span class="pre">save</span></code> operation. The objects operated this way
must fit memory.</p>
<p><code class="docutils literal notranslate"><span class="pre">read</span></code> is standard MATLAB command allowing users loading various data in memory. To allow operations with Horace
<code class="docutils literal notranslate"><span class="pre">.sqw</span></code> files  without overloading standard <code class="docutils literal notranslate"><span class="pre">read</span></code> command, Horace introduces <code class="docutils literal notranslate"><span class="pre">read_horace</span></code> family of commands.</p>
<section id="read-horace">
<h2><span class="section-number">7.1. </span>read_horace<a class="headerlink" href="#read-horace" title="Permalink to this heading"></a></h2>
<p>Reads <code class="docutils literal notranslate"><span class="pre">sqw</span></code> or <code class="docutils literal notranslate"><span class="pre">dnd</span></code> data from a file. The object type is determined from
the contents of the file.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">read_horace</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</pre></div>
</div>
<p>The returned variable is an <code class="docutils literal notranslate"><span class="pre">sqw</span></code> or <code class="docutils literal notranslate"><span class="pre">dnd</span></code> object.</p>
</section>
<section id="read-sqw">
<h2><span class="section-number">7.2. </span>read_sqw<a class="headerlink" href="#read-sqw" title="Permalink to this heading"></a></h2>
<p>Reads <code class="docutils literal notranslate"><span class="pre">sqw</span></code> data from a file.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">read_sqw</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</pre></div>
</div>
<p>The returned variable is an <code class="docutils literal notranslate"><span class="pre">sqw</span></code> object.</p>
</section>
<section id="read-dnd">
<h2><span class="section-number">7.3. </span>read_dnd<a class="headerlink" href="#read-dnd" title="Permalink to this heading"></a></h2>
<p>As <a class="reference internal" href="#read-sqw">read_sqw</a>, but reads <code class="docutils literal notranslate"><span class="pre">dnd</span></code> data saved to file. If the file contains a
full sqw dataset, then only the binned data will be read.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">read_dnd</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</pre></div>
</div>
<p>The returned variable is an <code class="docutils literal notranslate"><span class="pre">dnd</span></code> object.</p>
</section>
<section id="constructing-sqw-object-from-filename">
<h2><span class="section-number">7.4. </span>Constructing <code class="docutils literal notranslate"><span class="pre">sqw</span></code> object from filename<a class="headerlink" href="#constructing-sqw-object-from-filename" title="Permalink to this heading"></a></h2>
<p>Calling <code class="docutils literal notranslate"><span class="pre">sqw</span></code> constructor with the name of binary sqw file is equivalent to invoking <code class="docutils literal notranslate"><span class="pre">read_sqw</span></code> function.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sqw</span><span class="p">(</span><span class="n">sqw_filename</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="saving-sqw-objects-from-memory-and-creating-filebacked-objects">
<h1><span class="section-number">8. </span>Saving sqw objects from memory and creating filebacked objects<a class="headerlink" href="#saving-sqw-objects-from-memory-and-creating-filebacked-objects" title="Permalink to this heading"></a></h1>
<section id="save">
<h2><span class="section-number">8.1. </span>save<a class="headerlink" href="#save" title="Permalink to this heading"></a></h2>
<p>There are two ways of saving <code class="docutils literal notranslate"><span class="pre">sqw</span></code> or <code class="docutils literal notranslate"><span class="pre">dnd</span></code> objects to files on disk.</p>
<p>First – use MATLAB <code class="docutils literal notranslate"><span class="pre">save</span></code> command, which would
save objects from memory into MATLAB <code class="docutils literal notranslate"><span class="pre">.mat</span></code> files, and second one – using
Horace overload for <code class="docutils literal notranslate"><span class="pre">save</span></code> command in storing objects in <code class="docutils literal notranslate"><span class="pre">sqw</span></code> file format.
MATLAB command works the same as for any MATLAB variable:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">save</span><span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span><span class="s">&#39;variable1_name&#39;</span><span class="p">,</span><span class="s">&#39;variable2_name&#39;</span><span class="p">,</span><span class="k">...</span><span class="c">);</span>
</pre></div>
</div>
<p>The benefit of this way of storing data is the possibility of storing multiple objects in a single <code class="docutils literal notranslate"><span class="pre">.mat</span></code> file.</p>
<p>Note that the method works for objects in memory so if you use it to save filebacked <code class="docutils literal notranslate"><span class="pre">sqw</span></code> objects you will probably obtain
unexpected results, as main part of filebacked <code class="docutils literal notranslate"><span class="pre">sqw</span></code> object is not loaded in memory.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Saving filebacked objects using MATLAB ``save`` command is dangerous!</strong></p>
<p>One can say that filebacked objects can be created in two ways. First way – “primary” filebacked objects build over existing sqw files or saved with permanent file name. (see below). These objects are backed by permanent <code class="docutils literal notranslate"><span class="pre">.sqw</span></code> files which stay on disk after objects are deleted from MATLAB session. Second way – “secondary” filebacked objects obtained as the result of various operations with filebacked sqw objects, e.g. large cuts which do not fit memory – (see <a class="reference internal" href="Cutting_data_of_interest_from_SQW_files_and_objects.html#file-and-memory-backed-cuts"><span class="std std-ref">File- and memory-backed cuts</span></a> for more details about filebacked cuts), the result of unary or binary operations between “primary” filebacked <code class="docutils literal notranslate"><span class="pre">sqw</span></code> objects, results of filebacked <code class="docutils literal notranslate"><span class="pre">PageOp</span></code> algorithms, etc..
These objects are backed by temporary files with extension <code class="docutils literal notranslate"><span class="pre">.tmp_XXXXXXX</span></code> and temporary files get deleted when such objects go out of scope.</p>
<p>MATLAB <code class="docutils literal notranslate"><span class="pre">save</span></code> command saves part of filebacked object stored in memory. The operation is saving the reference to the file containing the pixels – the name and path to the file the object is backed by. As temporary <code class="docutils literal notranslate"><span class="pre">sqw</span></code> (<code class="docutils literal notranslate"><span class="pre">.tmp_XXXXXXX</span></code>)
file backing the object gets deleted, <code class="docutils literal notranslate"><span class="pre">.mat</span></code> file for stored “secondary” type of filebacked object will contain incorrect reference to the missing file. <code class="docutils literal notranslate"><span class="pre">.mat</span></code> file for the “primary” filebacked object will contain reference to existing <code class="docutils literal notranslate"><span class="pre">.sqw</span></code> file, so can be restored back until the referred file exists and is not moved or renamed. Obviously, this way of saving filebacked <code class="docutils literal notranslate"><span class="pre">sqw</span></code> objects is also not very reliable.</p>
</div>
<p>The only reliable way of saving filebacked <code class="docutils literal notranslate"><span class="pre">sqw</span></code> object is to use Horace <code class="docutils literal notranslate"><span class="pre">save</span></code> command, which stores <code class="docutils literal notranslate"><span class="pre">sqw</span></code> object in binary Horace <code class="docutils literal notranslate"><span class="pre">.sqw</span></code> file format.
The command for this is:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">save</span><span class="p">(</span><span class="n">sqw_object</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">);</span>
</pre></div>
</div>
<p>This method saves single object into Horace binary file with extension <code class="docutils literal notranslate"><span class="pre">.sqw</span></code>, so if you have filebacked <code class="docutils literal notranslate"><span class="pre">sqw</span></code> object, the method would correctly
write this object. It will be possible to restore the object later by accessing appropriate <code class="docutils literal notranslate"><span class="pre">.sqw</span></code> file. If your filebacked object is backed by temporary file, the object will not be physically saved (long operation) as the major part of this object is already located in file. The file contents will be synchronized with the data in memory and temporary file will be renamed to the name, you have provided as the second input for the <code class="docutils literal notranslate"><span class="pre">save</span></code> command.</p>
<p>You, of course, can also use Horace <code class="docutils literal notranslate"><span class="pre">save</span></code> command to create Horace binary <code class="docutils literal notranslate"><span class="pre">.sqw</span></code> files from <code class="docutils literal notranslate"><span class="pre">sqw/dnd</span></code> objects in memory.</p>
<p>See <a class="reference internal" href="Cutting_data_of_interest_from_SQW_files_and_objects.html#file-and-memory-backed-cuts"><span class="std std-ref">File- and memory-backed cuts</span></a> to read a bit more about filebacked and memory based cuts and <a class="reference internal" href="Changing_Horace_settings.html#horace-config"><span class="std std-ref">Horace Config</span></a> for the information on how to set up the size of memory based object.</p>
</section>
<section id="create-filebacked-objects-from-data-on-disk">
<h2><span class="section-number">8.2. </span>Create filebacked objects from data on disk<a class="headerlink" href="#create-filebacked-objects-from-data-on-disk" title="Permalink to this heading"></a></h2>
<p>If your <code class="docutils literal notranslate"><span class="pre">sqw</span></code> file is big enough (see <a class="reference internal" href="Changing_Horace_settings.html#horace-config"><span class="std std-ref">mem_chunk_size and fb_scale_factor from “hor_config” class</span></a> for numerical meaning of “big enough”, the command:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">fb_obj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sqw</span><span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>will create filebacked object <code class="docutils literal notranslate"><span class="pre">fb_obj</span></code>. You can operate with filebacked object exactly as with memory based object, but many operations which involve operations with pixels will be slower. Alternatively, you may create filebacked object regardless of its size using command:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">fb_obj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">read_sqw</span><span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span><span class="s">&#39;-filebacked&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Note, that this command invoked without <cite>-filebacked</cite> is equivalent to <code class="docutils literal notranslate"><span class="pre">sqw('filename')</span></code> and</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">mb_obj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">read_sqw</span><span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span><span class="s">&#39;-force_pix_location&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>will try to load <code class="docutils literal notranslate"><span class="pre">sqw</span></code> object in memory regardless of its size on disk, so will fail if the object is to big to fit the memory.</p>
<p>The filebacked objects created this way, unlike filebacked objects created as the result of the operations with filebacked objects or large <code class="docutils literal notranslate"><span class="pre">cut</span></code> operations, are backed by permanent files which would not be deleted if the object in memory gets deleted.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Special_sqw_information.html" class="btn btn-neutral float-left" title="6. Special SQW information from sqw objects and files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Reshaping_etc.html" class="btn btn-neutral float-right" title="9. Other shape functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2006-2025, STFC RAL.
      <span class="lastupdated">Last updated on Jun 4, 2025, 1:39:40 PM.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
<br><br>
<a href="https://github.com/pace-neutrons/Horace/edit/master/documentation/user_docs/docs/manual/Save_and_load.rst">Click here to edit</a> or <a href="https://github.com/pace-neutrons/Horace/edit/master/documentation/user_docs/docs/new_page.rst">Click here to add new page</a> (requires <a href="https://github.com/login">GitHub account</a>).
<br>
For more info on editing <a href="../Contributing.html">click here</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>