

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>17. Running Horace in Parallel &mdash; Horace  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="18. Changing Horace settings" href="Changing_Horace_settings.html" />
    <link rel="prev" title="16. Tobyfit" href="Tobyfit.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Horace
              <img src="../_static/150px-Quintus_Horatius_Flaccus.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Introduction and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User_guide.html">User’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../Horace_manual.html">Horace Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Planning_a_Horace_scan.html">1. Planning a Horace scan</a></li>
<li class="toctree-l2"><a class="reference internal" href="Generating_SQW_files.html">2. Generating SQW files</a></li>
<li class="toctree-l2"><a class="reference internal" href="Data_diagnostics.html">3. Data diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="Correcting_for_sample_misalignment.html">4. Correcting for sample misalignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="Cutting_data_of_interest_from_SQW_files_and_objects.html">5. Cutting data of interest from SQW files and objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="Special_sqw_information.html">6. Special <code class="docutils literal notranslate"><span class="pre">SQW</span></code> information from sqw objects and files</a></li>
<li class="toctree-l2"><a class="reference internal" href="Save_and_load.html">7. Loading <code class="docutils literal notranslate"><span class="pre">sqw</span></code> and <code class="docutils literal notranslate"><span class="pre">dnd</span></code> objects to memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="Save_and_load.html#saving-sqw-objects-from-memory-and-creating-filebacked-objects">8. Saving sqw objects from memory and creating filebacked objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="Reshaping_etc.html">9. Other shape functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Symmetrising_etc.html">10. Symmetry Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Unary_operations.html">11. Unary operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Binary_operations.html">12. Binary operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Plotting.html">13. Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="Simulation.html">14. Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Multifit.html">15. Multifit</a></li>
<li class="toctree-l2"><a class="reference internal" href="Tobyfit.html">16. Tobyfit</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">17. Running Horace in Parallel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#controlling-mpi">17.1. Controlling MPI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#enabling-locally">17.1.1. Enabling Locally</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enabling-globally">17.1.2. Enabling Globally</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mpi-schemes">17.2. MPI Schemes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#managing-parallel-jobs">17.3. Managing parallel jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#slurm-jobs">17.4. Slurm Jobs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Changing_Horace_settings.html">18. Changing Horace settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="List_of_functions.html">List of functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Input_file_formats.html">Input file formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="FAQ.html">FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Example_scripts.html">Example Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Citing.html">Citing Horace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Developers.html">For Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Contributing.html">Contributing to Horace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../General_disclaimer.html">General disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Previous_versions.html">Previous Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Horace</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../Horace_manual.html">Horace Manual</a></li>
      <li class="breadcrumb-item active"><span class="section-number">17. </span>Running Horace in Parallel</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/manual/Parallel.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="running-horace-in-parallel">
<h1><span class="section-number">17. </span>Running Horace in Parallel<a class="headerlink" href="#running-horace-in-parallel" title="Permalink to this heading"></a></h1>
<section id="controlling-mpi">
<h2><span class="section-number">17.1. </span>Controlling MPI<a class="headerlink" href="#controlling-mpi" title="Permalink to this heading"></a></h2>
<p>Certain operations in Horace have parallelised variants which can be used to
speed up large operations.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Due to the nature of parallelism, some parallel operations require extra
memory which may be up to twice the size of the <code class="docutils literal notranslate"><span class="pre">sqw</span></code> objects you’re
operating on.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be aware that for small jobs or some combinations of parameters, parallel
calculation may, in fact, be slower than serial execution due to startup
times and message sending. In future we hope to bring these times down and
efficiencies up.</p>
</div>
<section id="enabling-locally">
<h3><span class="section-number">17.1.1. </span>Enabling Locally<a class="headerlink" href="#enabling-locally" title="Permalink to this heading"></a></h3>
<p>To run a particular function in parallel there is a function called
<code class="docutils literal notranslate"><span class="pre">parallel_call</span></code> in Horace which runs a single task in parallel. Currently,
<code class="docutils literal notranslate"><span class="pre">parallel_call</span></code> is available for:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fit</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cut</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">func_eval</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqw_eval</span></code></p></li>
</ul>
<p>The syntax for using <code class="docutils literal notranslate"><span class="pre">parallel_call</span></code> is as follows:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parallel_call</span><span class="p">(@</span><span class="k">function</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">argument</span><span class="p">,</span><span class="w"> </span><span class="nb">arguments</span><span class="p">})</span>

<span class="c">% Equivalent to</span>

<span class="n">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span><span class="w"> </span><span class="nb">arguments</span><span class="p">)</span>

<span class="c">% E.g.</span>

<span class="n">proj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">line_proj</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]);</span>
<span class="n">w_out</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parallel_call</span><span class="p">(@</span><span class="n">cut</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">w_in</span><span class="p">,</span><span class="w"> </span><span class="n">proj</span><span class="p">,</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mf">0.2</span><span class="w"> </span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">10</span><span class="w"> </span><span class="mi">20</span><span class="p">]});</span>
</pre></div>
</div>
<p>In order to use <code class="docutils literal notranslate"><span class="pre">parallel_call</span></code> you must ensure MPI has been <a class="reference internal" href="#mpi-schemes">configured
correctly</a>.</p>
</section>
<section id="enabling-globally">
<h3><span class="section-number">17.1.2. </span>Enabling Globally<a class="headerlink" href="#enabling-globally" title="Permalink to this heading"></a></h3>
<p>Parallel operations can be enabled globally using:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">hpc</span><span class="p">(</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively different parallel components can be enabled/disabled separately
through <code class="docutils literal notranslate"><span class="pre">hpc_config</span></code> (see: <a class="reference internal" href="Changing_Horace_settings.html#changing-horace-settings"><span class="std std-ref">changing Horace settings</span></a>)</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">hpc_config</span><span class="w"> </span><span class="s">with</span><span class="w"> </span><span class="s">properties:</span>

<span class="w">    </span><span class="n">build_sqw_in_parallel</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">parallel_workers_number</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="n">combine_sqw_using</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;matlab&#39;</span>
<span class="w">      </span><span class="n">combine_sqw_options</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;matlab&#39;</span><span class="w">  </span><span class="s">&#39;mex_code&#39;</span><span class="w">  </span><span class="s">&#39;mpi_code&#39;</span><span class="p">}</span>
<span class="w">  </span><span class="n">mex_combine_thread_mode</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">mex_combine_buffer_size</span><span class="p">:</span><span class="w"> </span><span class="mi">131072</span>
<span class="w">        </span><span class="n">parallel_multifit</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">         </span><span class="n">parallel_cluster</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;herbert&#39;</span>
<span class="w">   </span><span class="n">parallel_configuration</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>1<span class="n">x1</span><span class="w"> </span><span class="n">parallel_config</span><span class="p">]</span>
<span class="w">              </span><span class="n">hpc_options</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>1<span class="n">x6</span><span class="w"> </span><span class="nb">cell</span><span class="p">}</span>
<span class="w">               </span><span class="n">class_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;hpc_config&#39;</span>
<span class="w">                 </span><span class="n">saveable</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">         </span><span class="n">returns_defaults</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">            </span><span class="n">config_folder</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/home/jacob/.matlab/mprogs_config&#39;</span>
</pre></div>
</div>
<p>In particular, the parallel enabling options are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parallel_multifit</span></code> : Enable parallel fitting for <code class="docutils literal notranslate"><span class="pre">multifit</span></code> and
<code class="docutils literal notranslate"><span class="pre">tobyfit</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build_sqw_in_parallel</span></code> : Enable building sqw objects in parallel,
i.e. <code class="docutils literal notranslate"><span class="pre">gen_sqw</span></code>, <code class="docutils literal notranslate"><span class="pre">combine_sqw</span></code></p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">parallel_config</span></code> contains most of the information to manage parallelism,
though some is stored in <code class="docutils literal notranslate"><span class="pre">hpc_config</span></code> (described above):</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">parallel_config</span><span class="w"> </span><span class="s">with</span><span class="w"> </span><span class="s">properties:</span>

<span class="w">                   </span><span class="n">worker</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;worker_v4&#39;</span>
<span class="w">              </span><span class="n">is_compiled</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">         </span><span class="n">parallel_cluster</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;herbert&#39;</span>
<span class="w">           </span><span class="n">cluster_config</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;local&#39;</span>
<span class="w">           </span><span class="n">known_clusters</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;herbert&#39;</span><span class="w">  </span><span class="s">&#39;parpool&#39;</span><span class="w">  </span><span class="s">&#39;mpiexec_mpi&#39;</span><span class="w">  </span><span class="s">&#39;slurm_mpi&#39;</span><span class="w">  </span><span class="s">&#39;dummy&#39;</span><span class="p">}</span>
<span class="w">      </span><span class="n">known_clust_configs</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;local&#39;</span><span class="p">}</span>
<span class="w">   </span><span class="n">shared_folder_on_local</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">  </span><span class="n">shared_folder_on_remote</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">        </span><span class="n">working_directory</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/tmp/&#39;</span>
<span class="w">         </span><span class="n">wkdir_is_default</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">         </span><span class="n">external_mpiexec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">               </span><span class="n">class_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;parallel_config&#39;</span>
<span class="w">                 </span><span class="n">saveable</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">         </span><span class="n">returns_defaults</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">            </span><span class="n">config_folder</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/home/jacob/.matlab/mprogs_config&#39;</span>
</pre></div>
</div>
</section>
</section>
<section id="mpi-schemes">
<span id="id1"></span><h2><span class="section-number">17.2. </span>MPI Schemes<a class="headerlink" href="#mpi-schemes" title="Permalink to this heading"></a></h2>
<p>Horace can be run in parallel with a number of different schemes, all controlled
through the <code class="docutils literal notranslate"><span class="pre">parallel_config</span></code>.</p>
<p>The five currently implemented parallel schemes are:</p>
<p>1. <code class="docutils literal notranslate"><span class="pre">herbert</span></code> (Poor-man’s MPI) - Data messages are sent through files written
to the hard drive and read by each process. This is the slowest MPI scheme, but
also the one with the fewest requirements.</p>
<p>2. <code class="docutils literal notranslate"><span class="pre">parpool</span></code> (Matlab Parallel Toolbox MPI) - Parpool uses Matlab’s parallel
toolbox parallelism to send messages and therefore requires the parallel toolbox
to be used.</p>
<p>3. <code class="docutils literal notranslate"><span class="pre">mpiexec_mpi</span></code> (C++ MPI) - Data messages are sent using C++ wrapping
OpenMPI. This requires the MEX files to be built in order to be used.</p>
<p>4. <code class="docutils literal notranslate"><span class="pre">slurm_mpi</span></code> (Slurm MPI) - Data messages are sent using C++ wrapping
OpenMPI, but are submitted to a running Slurm instance by Horace upon starting
the job. This requires the MEX files to be built in order to be used.</p>
<p>5. <code class="docutils literal notranslate"><span class="pre">dummy</span></code> (Dummy MPI) - Dummy MPI is not MPI, but simply a dummy system for
debugging and testing MPI algorithms on one process in serial.</p>
</section>
<section id="managing-parallel-jobs">
<h2><span class="section-number">17.3. </span>Managing parallel jobs<a class="headerlink" href="#managing-parallel-jobs" title="Permalink to this heading"></a></h2>
<p>Running jobs in parallel is as simple as selecting the appropriate MPI scheme,
setting an appropriate <code class="docutils literal notranslate"><span class="pre">parallel_workers_number</span></code> and enabling the appropriate
flags through the <code class="docutils literal notranslate"><span class="pre">hpc_config</span></code> and <code class="docutils literal notranslate"><span class="pre">parallel_config</span></code>.</p>
</section>
<section id="slurm-jobs">
<h2><span class="section-number">17.4. </span>Slurm Jobs<a class="headerlink" href="#slurm-jobs" title="Permalink to this heading"></a></h2>
<p>When running on Slurm-managed clusters, it is possible to automatically submit
jobs to the Slurm queue to be run in parallel across the cluster. This will
attempt to request the number of nodes required to run the selected number of
parallel workers and associated threads, however, if you are using a cluster
which requires non-standard options such as billing accounts and or non-default
queues specifying, it is possible to issue extra commands through the
<code class="docutils literal notranslate"><span class="pre">slurm_commands</span></code> variable accessible via the <code class="docutils literal notranslate"><span class="pre">parallel_config</span></code> object. This
is a <code class="docutils literal notranslate"><span class="pre">containers.Map</span></code> object, and will only store the latest set commands.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">new_commands</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">containers.Map</span><span class="p">({</span><span class="s">&#39;-A&#39;</span><span class="w"> </span><span class="s">&#39;-p&#39;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;account&#39;</span><span class="w"> </span><span class="s">&#39;partition&#39;</span><span class="p">});</span>
<span class="n">pc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parallel_config</span><span class="p">();</span>
<span class="n">pc</span><span class="p">.</span><span class="n">slurm_commands</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w">                                       </span><span class="c">% Delete existing Slurm commands</span>
<span class="n">pc</span><span class="p">.</span><span class="n">slurm_commands</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new_commands</span><span class="p">;</span><span class="w">                             </span><span class="c">% Set new map</span>
<span class="n">pc</span><span class="p">.</span><span class="n">slurm_commands</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;-A account -p=partition&#39;</span><span class="w">                 </span><span class="c">% Set as char</span>
<span class="n">pc</span><span class="p">.</span><span class="n">slurm_commands</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;-A&#39;</span><span class="w"> </span><span class="s">&#39;account&#39;</span><span class="w"> </span><span class="s">&#39;-p&#39;</span><span class="w"> </span><span class="s">&#39;partition&#39;</span><span class="p">}</span><span class="w">         </span><span class="c">% Set as cellstr of commands (must be in pairs)</span>
<span class="n">pc</span><span class="p">.</span><span class="n">slurm_commands</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{{</span><span class="s">&#39;-A&#39;</span><span class="w"> </span><span class="s">&#39;account&#39;</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;-p&#39;</span><span class="w"> </span><span class="s">&#39;partition&#39;</span><span class="p">}}</span><span class="w">     </span><span class="c">% Set as cell array of pairs of commands</span>
<span class="n">pc</span><span class="p">.</span><span class="n">update_slurm_commands</span><span class="p">(</span><span class="s">&#39;-A account -p=partition&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span><span class="w">    </span><span class="c">% Using update_slurm_commands setting append to false</span>
<span class="n">pc</span><span class="p">.</span><span class="n">update_slurm_commands</span><span class="p">(</span><span class="n">new_commands</span><span class="p">)</span><span class="w">                        </span><span class="c">% Using update_slurm_commands omitting append</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Setting <code class="docutils literal notranslate"><span class="pre">slurm_commands</span></code> by any of the above methods will remove all
existing <code class="docutils literal notranslate"><span class="pre">slurm_commands</span></code> and set the new ones.</p>
</div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">pc</span><span class="p">.</span><span class="n">slurm_commands</span><span class="p">(</span><span class="s">&#39;-A&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;account&#39;</span><span class="p">;</span><span class="w"> </span><span class="n">pc</span><span class="p">.</span><span class="n">slurm_commands</span><span class="p">(</span><span class="s">&#39;-p&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;partition&#39;</span><span class="w">            </span><span class="c">% Set through Map interface</span>
<span class="n">pc</span><span class="p">.</span><span class="n">update_slurm_commands</span><span class="p">(</span><span class="s">&#39;-A account -p=partition&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w">                            </span><span class="c">% Set through update_slurm_commands</span>
<span class="n">pc</span><span class="p">.</span><span class="n">update_slurm_commands</span><span class="p">(</span><span class="nb">containers.Map</span><span class="p">({</span><span class="s">&#39;-A&#39;</span><span class="w"> </span><span class="s">&#39;-p&#39;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;account&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;partition&#39;</span><span class="p">}),</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Setting <code class="docutils literal notranslate"><span class="pre">slurm_commands</span></code> by any of the above methods will simply overwrite
any existing <code class="docutils literal notranslate"><span class="pre">slurm_commands</span></code>.</p>
</div>
<p>It is possible to set the <code class="docutils literal notranslate"><span class="pre">slurm_commands</span></code> variable by loading the appropriate
commands from a file if that is what your cluster team provides. This is done by
using the following command:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">pc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parallel_config</span><span class="p">();</span>
<span class="n">pc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">pc</span><span class="p">.</span><span class="n">load_slurm_commands_from_file</span><span class="p">(</span><span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="nb">append</span><span class="o">&gt;</span><span class="p">);</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">filename</span></code> is the path of the file to load the commands from, and
<code class="docutils literal notranslate"><span class="pre">append</span></code> specifies whether the commands are meant to be added to the existing
commands or replace them entirely.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Tobyfit.html" class="btn btn-neutral float-left" title="16. Tobyfit" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Changing_Horace_settings.html" class="btn btn-neutral float-right" title="18. Changing Horace settings" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2006-2025, STFC RAL.
      <span class="lastupdated">Last updated on Jul 2, 2025, 5:48:16 PM.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
<br><br>
<a href="https://github.com/pace-neutrons/Horace/edit/master/documentation/user_docs/docs/manual/Parallel.rst">Click here to edit</a> or <a href="https://github.com/pace-neutrons/Horace/edit/master/documentation/user_docs/docs/new_page.rst">Click here to add new page</a> (requires <a href="https://github.com/login">GitHub account</a>).
<br>
For more info on editing <a href="../Contributing.html">click here</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>